(function() {
  'use strict';
  var cache, commonDatas, defaultLang, extend, i18n, pageDatas, translationsPath;
  defaultLang = 'en_US';
  i18n = false;
  translationsPath = false;
  pageDatas = false;
  commonDatas = {};
  cache = {};
  extend = function(object, properties) {
    var key, val;
    for (key in properties) {
      val = properties[key];
      object[key] = val;
    }
    return object;
  };
  angular.module('jed', []);
  angular.module('jed').factory('i18n', [
    '$http', '$rootScope', '$q', '$window', '$cookies', function($http, $rootScope, $q, $window, $cookies) {
      var get, getLang, jed, readyDeferred, setI18N;
      readyDeferred = $q.defer();
      getLang = function() {
        if (store.get('lang')) {
          return store.get('lang');
        } else {
          return defaultLang;
        }
      };
      get = function(file) {
        var deferred, varName;
        deferred = $q.defer();
        varName = file.replace('.json', '');
        if (window.translations && window.translations[varName]) {
          deferred.resolve(JSON.parse(window.translations[varName]));
        } else if (file in cache) {
          deferred.resolve(cache[file]);
        } else {
          $http.get("" + translationsPath + "/" + file).success(function(data) {
            cache[file] = data;
            return deferred.resolve(data);
          }).error(function() {
            return deferred.reject();
          });
        }
        return deferred.promise;
      };
      setI18N = function(data) {
        if (data == null) {
          data = false;
        }
        i18n = data ? new Jed(data) : void 0;
        $rootScope._ = function(key) {
          return jed._(key);
        };
        return $rootScope._n = function(singular_key, plural_key, value) {
          return jed._n(singular_key, plural_key, value);
        };
      };
      return jed = {
        setTranslationPath: function(path) {
          return translationsPath = path;
        },
        setDefaultLang: function(lang) {
          return defaultLang = lang;
        },
        loadCommon: function(common) {
          var deferred, lang;
          lang = getLang();
          deferred = $q.defer();
          get("" + common + "-" + lang + ".json").then(function(data) {
            commonDatas = extend(commonDatas, data.locale_data.messages);
            if (pageDatas) {
              pageDatas.locale_data.messages = extend(pageDatas.locale_data.messages, commonDatas);
              setI18N(pageDatas);
            } else {
              setI18N(data);
            }
            readyDeferred.resolve();
            return deferred.resolve();
          }, function() {
            readyDeferred.resolve();
            return deferred.resolve();
          });
          return deferred.promise;
        },
        loadPage: function(page) {
          var deferred, lang;
          lang = getLang();
          deferred = $q.defer();
          get("" + page + "-" + lang + ".json").then(function(data) {
            data.locale_data.messages = extend(data.locale_data.messages, commonDatas);
            pageDatas = data;
            setI18N(data);
            readyDeferred.resolve();
            return deferred.resolve();
          }, function() {
            if (lang === defaultLang) {
              setI18N();
            } else {
              store.set('lang', defaultLang);
              jed.loadPage(page);
            }
            readyDeferred.resolve();
            return deferred.resolve();
          });
          return deferred.promise;
        },
        _: function(key) {
          if (i18n) {
            return i18n.gettext(key);
          } else {
            return key;
          }
        },
        _n: function(singular_key, plural_key, value) {
          if (i18n) {
            return i18n.ngettext(singular_key, plural_key, value);
          } else {
            if (value === 1) {
              return singular_key;
            } else {
              return plural_key;
            }
          }
        },
        setLang: function(lang) {
          store.set('lang', lang);
          $cookies.lang = lang;
          return $window.location.reload();
        },
        getLang: function() {
          return getLang();
        },
        ready: function() {
          return readyDeferred.promise;
        }
      };
    }
  ]);
  return angular.module('jed').directive('trans', [
    'i18n', function(i18n) {
      return {
        restrict: 'E',
        replace: true,
        scope: {
          singular: '@',
          plural: '@',
          none: '@',
          count: '=',
          placeholders: '='
        },
        template: '<span>{{ result }}</span>',
        controller: function($scope, $element) {
          var key, name, ready, render, watchObjects, _count, _placeholders, _ref;
          ready = false;
          _.templateSettings.interpolate = /%([\s\S]+?)%/g;
          _placeholders = {};
          _count = 0;
          i18n.ready().then(function() {
            ready = true;
            return render(_count, _placeholders);
          });
          render = function(count, placeholders) {
            var result;
            _count = count;
            _placeholders = placeholders;
            if (!ready) {
              return;
            }
            if ($scope.count.toString() === '0' && $scope.none) {
              result = i18n._($scope.none);
            } else {
              result = i18n._n($scope.singular, $scope.plural, count);
            }
            console.log($scope.singular);
            return $scope.result = _.template(result, placeholders);
          };
          watchObjects = ['count'];
          _ref = Object.keys($scope.placeholders);
          for (key in _ref) {
            name = _ref[key];
            watchObjects.push("placeholders." + name);
          }
          return $scope.$watchGroup(watchObjects, function() {
            if (typeof parseInt($scope.count) !== 'number' || $scope.count === '') {
              return;
            }
            return render($scope.count, $scope.placeholders);
          });
        }
      };
    }
  ]);
})();

//# sourceMappingURL=data:application/json;base64,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b250ZW50IjpbIigtPlxuICAndXNlIHN0cmljdCdcblxuICBkZWZhdWx0TGFuZyA9ICdlbl9VUydcbiAgaTE4biA9IGZhbHNlXG4gIHRyYW5zbGF0aW9uc1BhdGggPSBmYWxzZVxuICBwYWdlRGF0YXMgPSBmYWxzZVxuICBjb21tb25EYXRhcyA9IHt9XG4gIGNhY2hlID0ge31cblxuICBleHRlbmQgPSAob2JqZWN0LCBwcm9wZXJ0aWVzKSAtPlxuICAgIGZvciBrZXksIHZhbCBvZiBwcm9wZXJ0aWVzXG4gICAgICBvYmplY3Rba2V5XSA9IHZhbFxuICAgIG9iamVjdFxuXG4gIGFuZ3VsYXIubW9kdWxlICdqZWQnLCBbXVxuXG4gIGFuZ3VsYXIubW9kdWxlKCdqZWQnKS5mYWN0b3J5ICdpMThuJywgW1xuICAgICckaHR0cCdcbiAgICAnJHJvb3RTY29wZSdcbiAgICAnJHEnXG4gICAgJyR3aW5kb3cnXG4gICAgJyRjb29raWVzJ1xuICAgICgkaHR0cCwgJHJvb3RTY29wZSwgJHEsICR3aW5kb3csICRjb29raWVzKSAtPlxuICAgICAgcmVhZHlEZWZlcnJlZCA9ICRxLmRlZmVyKClcbiAgICAgIGdldExhbmcgPSAtPlxuICAgICAgICBpZiBzdG9yZS5nZXQoJ2xhbmcnKSB0aGVuIHN0b3JlLmdldCgnbGFuZycpIGVsc2UgZGVmYXVsdExhbmdcblxuICAgICAgIyBHZXQgYSB0cmFuc2xhdGlvbiBmaWxlIGZyb20gY2FjaGUgb3IgYWpheFxuICAgICAgZ2V0ID0gKGZpbGUpIC0+XG4gICAgICAgIGRlZmVycmVkID0gJHEuZGVmZXIoKVxuICAgICAgICB2YXJOYW1lID0gZmlsZS5yZXBsYWNlKCcuanNvbicsICcnKVxuICAgICAgICBpZiB3aW5kb3cudHJhbnNsYXRpb25zIGFuZCB3aW5kb3cudHJhbnNsYXRpb25zW3Zhck5hbWVdXG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShKU09OLnBhcnNlIHdpbmRvdy50cmFuc2xhdGlvbnNbdmFyTmFtZV0pXG4gICAgICAgIGVsc2UgaWYgZmlsZSBvZiBjYWNoZVxuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoY2FjaGVbZmlsZV0pXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAkaHR0cC5nZXQoXCIje3RyYW5zbGF0aW9uc1BhdGh9LyN7ZmlsZX1cIilcbiAgICAgICAgICAgIC5zdWNjZXNzIChkYXRhKSAtPlxuICAgICAgICAgICAgICBjYWNoZVtmaWxlXSA9IGRhdGFcbiAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKVxuICAgICAgICAgICAgLmVycm9yIC0+XG4gICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlXG5cbiAgICAgICMgSW5pdGlhbGl6ZSBKZWRcbiAgICAgIHNldEkxOE4gPSAoZGF0YSA9IGZhbHNlKSAtPlxuICAgICAgICBpMThuID0gaWYgZGF0YSB0aGVuIG5ldyBKZWQoZGF0YSlcblxuICAgICAgICAkcm9vdFNjb3BlLl8gPSAoa2V5KSAtPlxuICAgICAgICAgIGplZC5fKGtleSlcblxuICAgICAgICAkcm9vdFNjb3BlLl9uID0gKHNpbmd1bGFyX2tleSwgcGx1cmFsX2tleSwgdmFsdWUpIC0+XG4gICAgICAgICAgamVkLl9uKHNpbmd1bGFyX2tleSwgcGx1cmFsX2tleSwgdmFsdWUpXG5cbiAgICAgICMgUHVibGljIEFQSVxuICAgICAgamVkID1cbiAgICAgICAgc2V0VHJhbnNsYXRpb25QYXRoOiAocGF0aCkgLT5cbiAgICAgICAgICB0cmFuc2xhdGlvbnNQYXRoID0gcGF0aFxuXG4gICAgICAgIHNldERlZmF1bHRMYW5nOiAobGFuZykgLT5cbiAgICAgICAgICBkZWZhdWx0TGFuZyA9IGxhbmdcblxuICAgICAgICAjIExvYWQgY29tbW9uIHRyYW5zbGF0aW9uc1xuICAgICAgICBsb2FkQ29tbW9uOiAoY29tbW9uKSAtPlxuICAgICAgICAgIGxhbmcgPSBnZXRMYW5nKClcbiAgICAgICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKClcbiAgICAgICAgICBnZXQoXCIje2NvbW1vbn0tI3tsYW5nfS5qc29uXCIpLnRoZW4oKGRhdGEpIC0+XG4gICAgICAgICAgICAjIG5vdCBzdXJlIHRoaXMgaXMgbmVlZGVkIHRob1xuICAgICAgICAgICAgY29tbW9uRGF0YXMgPSBleHRlbmQgY29tbW9uRGF0YXMsIGRhdGEubG9jYWxlX2RhdGEubWVzc2FnZXNcbiAgICAgICAgICAgIGlmIHBhZ2VEYXRhc1xuICAgICAgICAgICAgICBwYWdlRGF0YXMubG9jYWxlX2RhdGEubWVzc2FnZXMgPSBleHRlbmQgcGFnZURhdGFzLmxvY2FsZV9kYXRhLm1lc3NhZ2VzLCBjb21tb25EYXRhc1xuICAgICAgICAgICAgICBzZXRJMThOIHBhZ2VEYXRhc1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICBzZXRJMThOIGRhdGFcbiAgICAgICAgICAgIHJlYWR5RGVmZXJyZWQucmVzb2x2ZSgpXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKClcbiAgICAgICAgICAsIC0+XG4gICAgICAgICAgICByZWFkeURlZmVycmVkLnJlc29sdmUoKVxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpXG4gICAgICAgICAgKVxuICAgICAgICAgIGRlZmVycmVkLnByb21pc2VcblxuICAgICAgICAjIExvYWQgcGFnZSB0cmFuc2xhdGlvblxuICAgICAgICBsb2FkUGFnZTogKHBhZ2UpIC0+XG4gICAgICAgICAgbGFuZyA9IGdldExhbmcoKVxuICAgICAgICAgIGRlZmVycmVkID0gJHEuZGVmZXIoKVxuICAgICAgICAgIGdldChcIiN7cGFnZX0tI3tsYW5nfS5qc29uXCIpLnRoZW4oKGRhdGEpIC0+XG4gICAgICAgICAgICBkYXRhLmxvY2FsZV9kYXRhLm1lc3NhZ2VzID0gZXh0ZW5kIGRhdGEubG9jYWxlX2RhdGEubWVzc2FnZXMsIGNvbW1vbkRhdGFzXG4gICAgICAgICAgICBwYWdlRGF0YXMgPSBkYXRhXG4gICAgICAgICAgICBzZXRJMThOIGRhdGFcbiAgICAgICAgICAgIHJlYWR5RGVmZXJyZWQucmVzb2x2ZSgpXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKClcbiAgICAgICAgICAsIC0+XG4gICAgICAgICAgICBpZiBsYW5nID09IGRlZmF1bHRMYW5nXG4gICAgICAgICAgICAgIHNldEkxOE4oKVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICBzdG9yZS5zZXQgJ2xhbmcnLCBkZWZhdWx0TGFuZ1xuICAgICAgICAgICAgICBqZWQubG9hZFBhZ2UocGFnZSlcbiAgICAgICAgICAgIHJlYWR5RGVmZXJyZWQucmVzb2x2ZSgpXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKClcbiAgICAgICAgICApXG4gICAgICAgICAgZGVmZXJyZWQucHJvbWlzZVxuXG4gICAgICAgIF86IChrZXkpIC0+XG4gICAgICAgICAgaWYgaTE4biB0aGVuIGkxOG4uZ2V0dGV4dChrZXkpIGVsc2Uga2V5XG5cbiAgICAgICAgX246IChzaW5ndWxhcl9rZXksIHBsdXJhbF9rZXksIHZhbHVlKSAtPlxuICAgICAgICAgIGlmIGkxOG5cbiAgICAgICAgICAgIGkxOG4ubmdldHRleHQgc2luZ3VsYXJfa2V5LCBwbHVyYWxfa2V5LCB2YWx1ZVxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIGlmIHZhbHVlID09IDEgdGhlbiBzaW5ndWxhcl9rZXkgZWxzZSBwbHVyYWxfa2V5XG5cbiAgICAgICAgc2V0TGFuZzogKGxhbmcpIC0+XG4gICAgICAgICAgc3RvcmUuc2V0ICdsYW5nJywgbGFuZ1xuICAgICAgICAgICRjb29raWVzLmxhbmcgPSBsYW5nXG4gICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKVxuXG4gICAgICAgIGdldExhbmc6IC0+XG4gICAgICAgICAgZ2V0TGFuZygpXG5cbiAgICAgICAgcmVhZHk6IC0+XG4gICAgICAgICAgcmVhZHlEZWZlcnJlZC5wcm9taXNlXG4gIF1cblxuICBhbmd1bGFyLm1vZHVsZSgnamVkJykuZGlyZWN0aXZlICd0cmFucycsIFtcbiAgICAnaTE4bidcbiAgICAoaTE4bikgLT5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIHJlc3RyaWN0OiAnRSdcbiAgICAgICAgcmVwbGFjZTogdHJ1ZVxuICAgICAgICBzY29wZTpcbiAgICAgICAgICBzaW5ndWxhcjogJ0AnXG4gICAgICAgICAgcGx1cmFsOiAnQCdcbiAgICAgICAgICBub25lOiAnQCdcbiAgICAgICAgICBjb3VudDogJz0nXG4gICAgICAgICAgcGxhY2Vob2xkZXJzOiAnPSdcbiAgICAgICAgdGVtcGxhdGU6ICc8c3Bhbj57eyByZXN1bHQgfX08L3NwYW4+J1xuICAgICAgICBjb250cm9sbGVyOiAoJHNjb3BlLCAkZWxlbWVudCkgLT5cbiAgICAgICAgICByZWFkeSA9IGZhbHNlXG4gICAgICAgICAgXy50ZW1wbGF0ZVNldHRpbmdzLmludGVycG9sYXRlID0gLyUoW1xcc1xcU10rPyklL2c7XG4gICAgICAgICAgX3BsYWNlaG9sZGVycyA9IHt9XG4gICAgICAgICAgX2NvdW50ID0gMFxuXG4gICAgICAgICAgaTE4bi5yZWFkeSgpLnRoZW4gLT5cbiAgICAgICAgICAgIHJlYWR5ID0gdHJ1ZVxuICAgICAgICAgICAgcmVuZGVyKF9jb3VudCwgX3BsYWNlaG9sZGVycylcblxuICAgICAgICAgIHJlbmRlciA9IChjb3VudCwgcGxhY2Vob2xkZXJzKSAtPlxuICAgICAgICAgICAgX2NvdW50ID0gY291bnRcbiAgICAgICAgICAgIF9wbGFjZWhvbGRlcnMgPSBwbGFjZWhvbGRlcnNcbiAgICAgICAgICAgIHJldHVybiB1bmxlc3MgcmVhZHlcbiAgICAgICAgICAgIGlmICRzY29wZS5jb3VudC50b1N0cmluZygpID09ICcwJyBhbmQgJHNjb3BlLm5vbmVcbiAgICAgICAgICAgICAgcmVzdWx0ID0gaTE4bi5fICRzY29wZS5ub25lXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgIHJlc3VsdCA9IGkxOG4uX24gJHNjb3BlLnNpbmd1bGFyLCAkc2NvcGUucGx1cmFsLCBjb3VudFxuICAgICAgICAgICAgY29uc29sZS5sb2cgJHNjb3BlLnNpbmd1bGFyXG4gICAgICAgICAgICAkc2NvcGUucmVzdWx0ID0gXy50ZW1wbGF0ZShyZXN1bHQsIHBsYWNlaG9sZGVycylcblxuICAgICAgICAgIHdhdGNoT2JqZWN0cyA9IFsnY291bnQnXVxuXG4gICAgICAgICAgZm9yIGtleSwgbmFtZSBvZiBPYmplY3Qua2V5cygkc2NvcGUucGxhY2Vob2xkZXJzKVxuICAgICAgICAgICAgd2F0Y2hPYmplY3RzLnB1c2ggXCJwbGFjZWhvbGRlcnMuI3tuYW1lfVwiXG5cbiAgICAgICAgICAkc2NvcGUuJHdhdGNoR3JvdXAod2F0Y2hPYmplY3RzLCAtPlxuICAgICAgICAgICAgaWYgdHlwZW9mIHBhcnNlSW50KCRzY29wZS5jb3VudCkgIT0gJ251bWJlcicgb3IgJHNjb3BlLmNvdW50ID09ICcnXG4gICAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgICAgICByZW5kZXIoJHNjb3BlLmNvdW50LCAkc2NvcGUucGxhY2Vob2xkZXJzKVxuICAgICAgICAgIClcbiAgICAgIClcbiAgXVxuKSgpXG4iXX0=